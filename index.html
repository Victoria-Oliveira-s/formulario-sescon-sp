<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Atualização Cadastral - Sescon-SP</title>
    <style>
        /* --- ESTILOS --- (Nenhuma mudança aqui, apenas mantidos) */
        body { margin: 0; font-family: 'Roboto', Arial, sans-serif; display: flex; justify-content: center; align-items: center; min-height: 100vh; background: url('https://i.imgur.com/iE3JKYM.png' ) no-repeat center center fixed; background-size: cover; }
        .container { background-color: rgba(0, 151, 206, 0.6); padding: 18px; border-radius: 12px; width: 100%; max-width: 600px; color: #fff; box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2); }
        h1 { text-align: center; color: #fff; margin-bottom: 5px; font-size: 1.7em; }
        .subtitulo-sescon { text-align: center; color: #fff; font-size: 1.4em; margin-top: 0px; margin-bottom: 20px; font-weight: bold; }
        .descricao { text-align: center; font-size: 1.05em; color: #fff; margin-bottom: 18px; line-height: 1.5em; }
        section { margin-bottom: 24px; padding: 14px; border-radius: 10px; background-color: rgba(255, 255, 255, 0.8); border: 1px solid #0097ce; }
        section h2 { color: #0097ce; font-size: 1.2em; margin-bottom: 12px; }
        label { display: block; font-weight: bold; margin-bottom: 8px; color: #333; }
        input[type="text"], input[type="email"], input[type="tel"], input[type="number"], input[type="date"], select { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 6px; font-size: 16px; margin-bottom: 12px; box-sizing: border-box; }
        .comunicacao-titulo { font-weight: bold; color: #333; margin-bottom: 8px; }
        section label { display: flex; align-items: center; margin-bottom: 8px; font-weight: normal; }
        section label input[type="checkbox"] { width: auto; margin-right: 8px; }
        .btn-add, .btn-submit { background-color: #fff; color: #0097ce; padding: 12px 18px; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: bold; display: inline-block; transition: background-color 0.3s ease; }
        .btn-add { margin-top: 8px; }
        .btn-add:hover, .btn-submit:hover { background-color: #f0f0f0; }
        .btn-submit { width: 100%; margin-top: 12px; }
        .mensagem-status { text-align: center; font-size: 1.1em; margin-top: 12px; display: none; }
        .mensagem-sucesso { color: #00cc88; }
        .mensagem-erro { color: #333; }
        .mensagem-erro::before { content: '❌ '; color: #ff3333; }
        footer { text-align: center; margin-top: 30px; }
        footer .logo { display: block; margin: 0 auto; max-width: 140px; height: auto; }
        .contact-title, .socio-title, .colaborador-title { color: #0097ce; font-size: 1.2em; }
        .item-header { display: flex; justify-content: space-between; align-items: center; margin-top: 20px; margin-bottom: 12px; padding-top: 10px; }
        .btn-remove { background-color: #ff4d4d; color: white; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 0.9em; font-weight: bold; display: inline-block; margin-left: 10px; white-space: nowrap; }
        .btn-remove:hover { background-color: #ff1a1a; }
        .hidden { display: none; }
        .item-block { border-top: 1px solid #ccc; margin-top: 15px; padding-top: 15px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Atualize seus dados cadastrais conosco</h1>
        <p class="subtitulo-sescon">Sescon - SP</p>
        <p class="descricao">Preencha corretamente todas as informações. Pelo menos um contato é obrigatório para garantirmos a comunicação eficaz.</p>

        <form id="formulario">
            <section>
                <h2>1. Identificação da Empresa</h2>
                <label for="cnpj">CNPJ:</label>
                <input type="text" id="cnpj" name="cnpj" readonly>
                <label for="razao">Razão Social:</label>
                <input type="text" id="razao" name="razao" readonly>
            </section>

            <section id="contact-section">
                <h2>2. Contatos</h2>
                <div class="contact-item">
                    <div class="item-header">
                        <h2 class="contact-title">Contato 1 (Obrigatório)</h2>
                    </div>
                    <label>Este e-mail receberá os comunicados selecionados abaixo:</label>
                    <input type="email" name="email[]" placeholder="ex: contato@empresa.com" required>
                    <label>Telefone:</label>
                    <input type="tel" name="telefone[]" placeholder="(DD) 99999-9999" required>
                    <label>Departamento:</label>
                    <select name="departamento[]" required>
                        <option value="">Selecione</option>
                        <option value="Socio">Sócio</option>
                        <option value="Diretoria">Diretoria</option>
                        <option value="Recursos Humanos">Recursos Humanos (RH)</option>
                        <option value="Departamento Pessoal">Departamento Pessoal</option>
                        <option value="Financeiro">Financeiro</option>
                        <option value="Contabilidade">Contabilidade</option>
                        <option value="Juridico">Jurídico</option>
                        <option value="Marketing">Marketing</option>
                        <option value="Outros">Outros</option>
                    </select>
                    <p class="comunicacao-titulo">Selecione os tipos de comunicação que deseja receber:</p>
                    <label><input type="checkbox" name="comunicacoes[]" value="Boletos"> Boletos e Comunicados Financeiros</label>
                    <label><input type="checkbox" name="comunicacoes[]" value="Cursos"> Cursos, eventos e outros produtos e serviços</label>
                    <label><input type="checkbox" name="comunicacoes[]" value="Assembleias"> Convocações para Assembleias</label>
                    <label style="margin-bottom: 20px;"><input type="checkbox" name="comunicacoes[]" value="Noticias"> Notícias e Informativos Gerais</label>
                </div>
                <button type="button" class="btn-add" onclick="addContact()">+ Adicionar Contato</button>
            </section>

            <!-- INÍCIO DA NOVA SEÇÃO DE SÓCIOS -->
            <section id="socios-section">
                <h2>3. Sócios (Opcional)</h2>
                <div id="socios-container"></div>
                <button type="button" class="btn-add" onclick="addSocio()">+ Adicionar Sócio</button>
            </section>
            <!-- FIM DA NOVA SEÇÃO DE SÓCIOS -->

            <!-- INÍCIO DA NOVA SEÇÃO DE COLABORADORES -->
            <section id="colaboradores-section">
                <h2>4. Colaboradores (Opcional)</h2>
                <div id="colaboradores-container"></div>
                <button type="button" class="btn-add" onclick="addColaborador()">+ Adicionar Colaborador</button>
            </section>
            <!-- FIM DA NOVA SEÇÃO DE COLABORADORES -->

            <section>
                <h2>5. Informações da Empresa</h2>
                <label for="faturamento">Faturamento Bruto Anual (para cálculo das contribuições):</label>
                <input type="text" id="faturamento" name="faturamento" placeholder="Ex: R$ 1.200.000,00" required>
                <label for="funcionarios">Quantidade de Funcionários:</label>
                <input type="number" id="funcionarios" name="funcionarios" placeholder="Ex: 25" min="0" required>
            </section>

            <button type="submit" class="btn-submit">Enviar Atualização</button>
            <p class="mensagem-status"></p>
        </form>
        <footer><img src="https://i.imgur.com/zWWSzuu.png" alt="Logo Sescon-SP" class="logo"></footer>
    </div>

    <script>
        // --- FUNÇÕES DE MÁSCARA (Nenhuma mudança aqui ) ---
        function applyPhoneMask(element) { /* ...código da máscara de telefone... */ }
        function applyCurrencyMask(element) { /* ...código da máscara de faturamento... */ }
        function applyCpfMask(element) {
            element.addEventListener('input', function(e) {
                let value = e.target.value.replace(/\D/g, '').substring(0, 11);
                value = value.replace(/(\d{3})(\d)/, '$1.$2');
                value = value.replace(/(\d{3})(\d)/, '$1.$2');
                value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
                e.target.value = value;
            });
        }
        
        // --- FUNÇÕES PARA ADICIONAR ITENS (NOVAS E ATUALIZADAS) ---
        function addContact() { /* ...código para adicionar contato... */ }
        
        function addSocio() {
            const container = document.getElementById('socios-container');
            const count = container.children.length + 1;
            const newSocio = document.createElement('div');
            newSocio.className = 'item-block';
            newSocio.innerHTML = `
                <div class="item-header">
                    <h3 class="socio-title">Sócio ${count}</h3>
                    <span class="btn-remove" onclick="this.parentElement.parentElement.remove()">Remover</span>
                </div>
                <label>Nome do Sócio:</label>
                <input type="text" name="socio_nome[]">
                <label>CPF do Sócio:</label>
                <input type="text" name="socio_cpf[]">
                <label>Data de Entrada:</label>
                <input type="date" name="socio_data[]">
            `;
            container.appendChild(newSocio);
            applyCpfMask(newSocio.querySelector('input[name="socio_cpf[]"]'));
        }

        function addColaborador() {
            const container = document.getElementById('colaboradores-container');
            const count = container.children.length + 1;
            const newColaborador = document.createElement('div');
            newColaborador.className = 'item-block';
            newColaborador.innerHTML = `
                <div class="item-header">
                    <h3 class="colaborador-title">Colaborador ${count}</h3>
                    <span class="btn-remove" onclick="this.parentElement.parentElement.remove()">Remover</span>
                </div>
                <label>Nome do Colaborador:</label>
                <input type="text" name="colaborador_nome[]">
                <label>CPF do Colaborador:</label>
                <input type="text" name="colaborador_cpf[]">
                <label>Data de Admissão:</label>
                <input type="date" name="colaborador_data[]">
            `;
            container.appendChild(newColaborador);
            applyCpfMask(newColaborador.querySelector('input[name="colaborador_cpf[]"]'));
        }

        // --- LÓGICA DE ENVIO DO FORMULÁRIO (ATUALIZADA) ---
        document.getElementById('formulario').addEventListener('submit', function (e) {
            e.preventDefault();
            const statusMsg = document.querySelector('.mensagem-status');
            statusMsg.style.display = 'block';

            // ... (validações de contato obrigatório e duplicatas permanecem aqui) ...

            statusMsg.textContent = 'Enviando...';
            
            const cnpj = document.getElementById('cnpj').value;
            const razaoSocial = document.getElementById('razao').value;
            const faturamento = document.getElementById('faturamento').value;
            const funcionarios = document.getElementById('funcionarios').value;

            const contatos = [];
            document.querySelectorAll('.contact-item').forEach(item => { /* ...código para coletar contatos... */ });

            // NOVA LÓGICA PARA COLETAR SÓCIOS
            const socios = [];
            document.querySelectorAll('#socios-container .item-block').forEach(item => {
                const nome = item.querySelector('input[name="socio_nome[]"]').value;
                if (nome) { // Só adiciona se o nome for preenchido
                    socios.push({
                        nome: nome,
                        cpf: item.querySelector('input[name="socio_cpf[]"]').value,
                        data: item.querySelector('input[name="socio_data[]"]').value
                    });
                }
            });

            // NOVA LÓGICA PARA COLETAR COLABORADORES
            const colaboradores = [];
            document.querySelectorAll('#colaboradores-container .item-block').forEach(item => {
                const nome = item.querySelector('input[name="colaborador_nome[]"]').value;
                if (nome) { // Só adiciona se o nome for preenchido
                    colaboradores.push({
                        nome: nome,
                        cpf: item.querySelector('input[name="colaborador_cpf[]"]').value,
                        data: item.querySelector('input[name="colaborador_data[]"]').value
                    });
                }
            });

            // PAYLOAD ATUALIZADO
            const payload = { cnpj, razaoSocial, faturamento, funcionarios, contatos, socios, colaboradores };
            const url = 'SUA_URL_DO_APPS_SCRIPT_AQUI'; // Mantenha sua URL

            fetch(url, {
                method: 'POST',
                mode: 'no-cors',
                cache: 'no-cache',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload),
                redirect: 'follow'
            })
            .then(res => {
                statusMsg.textContent = '✅ Dados enviados com sucesso!📩';
                statusMsg.className = 'mensagem-status mensagem-sucesso';
                document.getElementById('formulario').reset();
            })
            .catch(error => {
                statusMsg.textContent = '❌ Ocorreu um erro. Tente novamente.';
                statusMsg.className = 'mensagem-status mensagem-erro';
                console.error('Erro no fetch:', error);
            });
        });

        // --- CÓDIGO RESTANTE (pré-preenchimento, máscaras, etc.) ---
        // ... (todo o resto do seu script continua aqui, sem alterações) ...
    </script>
</body>
</html>
